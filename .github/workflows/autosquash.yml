## DO NOT EDIT!
# This file was provisioned by Terraform
# File origin: https://github.com/Arrow-air/tf-github/tree/main/src/templates/rust-svc/.github/workflows/autosquash.yml

name: Auto-squash

on:
  check_run:
    types:
      # Check runs completing successfully can unblock the corresponding pull requests and make them mergeable.
      - completed
  pull_request:
    types:
      # A closed pull request makes the checks on the other pull request on the same base outdated.
      - closed
      # Adding the autosquash label to a pull request can trigger an update or a merge.
      - labeled
  pull_request_review:
    types:
      # Review approvals can unblock the pull request and make it mergeable.
      - submitted
  # Success statuses can unblock the corresponding pull requests and make them mergeable.
  status: {}

jobs:
  autosquash:
    name: Autosquash
    runs-on: ubuntu-18.04
    steps:
      - name: Import Arrow bot's GPG key for signing commits
        id: import-gpg
        uses: crazy-max/ghaction-import-gpg@v4
        with:
          gpg_private_key: ${{ secrets.COMMITBOT_GPG_PRIVATE_KEY }}
          passphrase: ${{ secrets.COMMITBOT_GPG_PASSPHRASE }}
          git_config_global: true
          git_user_signingkey: true
          git_commit_gpgsign: true
          git_tag_gpgsign: true

      - name: Automatic Rebase Autosquash
        uses: cirrus-actions/rebase@1.7
        with:
          autosquash: ${{ true }}
